# explorer-shiny

This RStudio project has the source code for the Population Explorer front end.

This document, `README.html`, is generated by `README.Rmd` in the root folder of the project.  Please make edits to `README.Rmd` and compile with the "Knit" button.

### Usage

Open explorer-shiny.Rproj from RStudio (ie https://rstudio02.stats.govt.nz)

#### First time user?
If this is your first time with the app and you don't use R much you probably need to install some of the R packages it draws on.  Easiest way to do this is to open run the script `./prep/install-packages.R` (either by clicking "Source", or by selecting it all and clicking "Run" or ctrl-enter).  Note that nothing else in that `prep` folder needs to be run, it's just scribble at the moment (eg scripts to build the database overnight, in the absence of other ways of doing it given our fragile connections from our Surface Pros).

#### Regular run
To run the stable version, which points at the `IDI_Sandpit.pop-exp` schema on wtstsql35:

```{r eval = FALSE}
library(shiny)
runApp("pop-exp")
```

Or for the development version, which points at the `IDI_Sandpit.pop-exp-dev` schema:

```{r eval = FALSE}
library(shiny)
runApp("pop-exp-dev")
```

(You only need `library(shiny)` once per session).

### pseudo-branches

There are two versions of the app:

- pop-exp
- pop-exp-dev

All development should be done on pop-exp-dev, and periodically it should be just copied over to pop-exp (having first made sure the pop-exp schema in the database is up to date).  Some small changes need to be made in the pop-exp version after it has been copied over:

- change pop-exp-dev to pop-exp in the relevant line in `pop-exp/global.R`
- change pop-exp-dev to pop-exp in the relevant lines in `pop-exp/src/*.sql` ie the files `continuous.sql`, `density.sql`, `two-cat.sql`

### Overall approach

Within the app's own subfolder (eg `./pop-exp-dev`), the files that make up the actual app are in the root folder:

* `global.R` - R code that is run when the app is fired up and does things needed for both the client and server side eg grabs the values of the value and variable dimension tables from the database
* `server.R` - R code that controls the server-side of the app eg getting data from the database and turning it into charts and tables
* `ui.R` - R code that controls the client-side of the app ie the user interface, drop down boxes, rendering charts on the screen, etc.

There are also two subfolders of files:

* `src` - this holds source code for the skeleton templates of SQL queries that are then modified by `server.R`; and also a few R functions used for random rounding and for formatting SQL on screen
* `www` - this contains assets visible to the app's web page ie Cascading Style Sheets that make the headings orange and everything in the right font.

